# Phase 2 Build Plan — Multimodal + Rerank

**Last Updated:** 2025-11-23

This is the tickable action list for Phase 2. Each checkbox is sized to fit one agent session. **Agents MUST** (a) read `INDEX.md`, `CONTEXT.md`, `PROGRESS.md`, and `CURRENT_FOCUS.md` before starting, (b) update this file + `CONTEXT.md` + `PROGRESS.md` + diary entry after finishing a checkbox, and (c) leave a one-line comment at each step when checking it off (date/result/metrics).

## Slices (execute top-to-bottom)

- [x] **P2.1 — Kickoff & Hash Sync** (Orchestrator): Set Phase 2 start line in `CONTEXT.md`/`PROGRESS.md`; note priorities in `CURRENT_FOCUS.md`; recompute context hash; diary entry logged. *(2025-11-27 — Phase 2 marked in progress; hash refreshed; diary added.)*
- [x] **P2.2 — ADRs: Image Ingest + Rerank Provider/Cache** (Silent Architect): Draft/accept ADRs for image pipeline + rerank provider/caching; document constraints/SLAs; link to DATA_MODEL/API_CONTRACTS. *(2025-11-27 — ADR-003/ADR-004 drafted; awaiting acceptance; follow-up to link DATA_MODEL/API_CONTRACTS.)*
- [x] **P2.3 — Backend: Image Ingestion Pipeline** (Silent Architect): Implement workers for image ingest (thumbs, hash, cache reuse), MinIO paths, Qdrant image collections; unit tests + worker tests; manifest knobs honored. *(2025-12-01 — Image pipeline added with MinIO original+thumb storage, image embeddings/caching, modality-scoped Qdrant collections, manifest knobs, and worker/server tests updated.)*
- [x] **P2.4 — Backend: Crossmodal Search Path** (Silent Architect): Add query/image dual-mode search, payload parity, diagnostics for modality hits; contract tests + integration hitting real stack. *(2025-12-01 — Crossmodal mode added with image query support, modality-scoped vector search, schema/tests updated.)*
- [x] **P2.5 — Backend: Rerank Provider Integration** (Silent Architect): Wire provider client (API/local), clamp budgets, add caching, enrich diagnostics (applied/timeout/down); golden run with rerank enabled under p95<900ms. *(2025-12-01 — HTTP provider + cache added with TTL/size knobs; rerank diagnostics/issues extended; rerank skipped for image-only queries; tests updated.)*
- [x] **P2.6 — Backend: Refresh Endpoint** (Silent Architect): Implement `/v1/admin/refresh` end-to-end (jobs, worker handler, status surfacing); tests + runbook entry. *(2025-12-01 — Refresh API added with job enqueue + schema/tests; worker refresh stub registered; ready for worker handler/runbook follow-on.)*
- [x] **P2.7 — Backend: Export Endpoint** (Silent Architect): Implement `/v1/containers/export` tarball with manifest+metadata+blobs; MinIO pathing + access guard; tests + runbook entry. *(2025-12-01 — Export API enqueues jobs with schema/tests; worker export stub registered; ready for handler/runbook wiring.)*
- [x] **P2.8 — Frontend: Multi-Container Selector** (IKB Designer): Add container selector/state, adjust hooks for multi-target searches, UI wiring + a11y; RTL/Playwright updates. *(2025-12-01 — Selector added to search workspace with badges/filter/select-all; multi-container search enabled; RTL test updated.)*
- [x] **P2.9 — Frontend: Crossmodal UI & Diagnostics** (IKB Designer): Add image query input/preview, mode toggles (semantic/hybrid/crossmodal/rerank), diagnostics rail surfacing rerank/provider status; tests + Storybook. *(2025-12-01 — Crossmodal mode wired with image query upload + preview hooks; multi-mode toggle includes crossmodal; diagnostics toggle intact; hooks/types updated; RTL passing.)*
- [x] **P2.10 — Frontend: Refresh/Export Flows** (IKB Designer): UI for refresh/export triggers + progress, error/empty states, focus traps; RTL/Playwright coverage. *(2025-12-01 — Refresh/export maintenance card + focus-trapped modals with container selector, strategy/format toggles, job status panel, and MSW/RTL coverage added.)*
- [x] **P2.11 — Golden Expansion & Benchmarks** (Silent Architect): Extend golden queries/judgments for image + crossmodal cases; run baseline + rerank; record latency/nDCG/recall in artifacts; gate budgets. *(2025-12-01 — Golden suite expanded with crossmodal image query + judgments keyed by titles/uris; runner now accepts image payloads, multi-container ids, and graded relevance.)*
- [x] **P2.12 — Documentation & Runbooks Sync** (Orchestrator): Update `CONTEXT.md`, `PROGRESS.md`, `CURRENT_FOCUS.md`, `BLOCKERS.md` (if any), `TECHNICAL_DEBT.md` (new debt), `knowledge/DECISIONS.md`, `knowledge/LESSONS.md`, and relevant runbooks; diary entry; recompute context hash. *(2025-12-01 — CONTEXT/PROGRESS/CURRENT_FOCUS refreshed for maintenance UI + golden runner updates; diary logged; context hash recomputed.)*

**Reminder:** Do not proceed to the next checkbox until the current one is checked with a comment and the SSoT files are updated.
